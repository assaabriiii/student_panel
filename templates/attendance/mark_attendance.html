{% extends "base.html" %}
{% load static %}
{% block content %}
  <h2>Mark Attendance for {{ subject.name }} on {{ today }}</h2>
  <form method="post">
    {% csrf_token %}
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center" style="min-width:800px;">
        <thead class="table-light">
          <tr>
            <th style="position:sticky;left:0;background:#f8f9fa;z-index:2;">Student</th>
            {% for session_date in session_dates %}
              <th>{{ session_date }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
          <tr>
            <td style="position:sticky;left:0;background:#fff;z-index:1;text-align:left;white-space:nowrap;">{{ student.get_full_name }} ({{ student.university_number }})</td>
            {% for session_date in session_dates %}
              <td>
                {% if session_date == today %}
                  <input type="checkbox" name="student_{{ student.id }}" {% if student.id in present_ids %}checked{% endif %} />
                {% else %}
                  {% if attendance_matrix and attendance_matrix.student_id and attendance_matrix.student_id.session_date %}
                    <span style="color:green;font-weight:bold;font-size:1.2em;">✔</span>
                  {% else %}
                    <span style="color:red;font-weight:bold;font-size:1.2em;">✘</span>
                  {% endif %}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="mt-3">
      <button type="submit" class="btn btn-success">Save Attendance</button>
      <a href="{% url 'ta_dashboard' %}" class="btn btn-secondary ms-2">Cancel</a>
    </div>
  </form>
{% endblock %}
